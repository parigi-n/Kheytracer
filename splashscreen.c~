/*
** wolf3d.c for wold3d in /home/parigi_n/Testrendu/MUL_2014_wolf3d
** 
** Made by Nicolas PARIGI
** Login   <parigi_n@epitech.net>
** 
** Started on  Sun Dec 28 17:13:35 2014 Nicolas PARIGI
** Last update Tue May 26 18:00:49 2015 Nicolas PARIGI
*/

#include <minilibx/mlx.h>
#include <stdlib.h>
#include "X11/X.h"
#include "minilibx.h"

int		wolf3d_img(t_data *data)
{
  if ((data->img_ptr = mlx_xpm_file_to_image
       (data->mlx_ptr, "sky2.xpm", &data->x_xpm, &data->y_xpm)) == 0)
    return (-1);
  data->img_data = mlx_get_data_addr
    (data->img_ptr, &data->bpp, &data->sizeline, &data->endian);
  data->y = 240 - ((SCREEN_Y / 2) / (data->position));
  while (data->y < 240 + ((SCREEN_Y / 2) / (data->position)))
    {
      data->x = 0;
      while (data->x < SCREEN_X)
        my_pixel_put(data->x++, data->y, data, "065065065");
      data->y++;
    }
  while (data->y < SCREEN_Y)
    {
      data->x = 0;
      while (data->x < SCREEN_X)
        my_pixel_put(data->x++, data->y, data, "160160160");
      data->y++;
    }
  mlx_put_image_to_window(data->mlx_ptr, data->win_ptr, data->img_ptr, 0, 0);
  mlx_put_image_to_window
    (data->mlx_ptr, data->win_ptr, data->img_interface, 0, 318);
  return (0);
}

int		gere_key(int keycode, t_data *data)
{
  if (keycode == MLX_KEY_ESC)
    {
      exit(0);
    }
  if (keycode == MLX_KEY_UP && data->position > 1)
    {
      data->position--;
    }
  if (keycode == MLX_KEY_DOWN)
    {
      data->position++;
    }
  wolf3d_img(data);
  return (0);
}

int		gere_expose(t_data *data)
{
  mlx_put_image_to_window(data->mlx_ptr, data->win_ptr, data->img_ptr, 0, 0);
  mlx_put_image_to_window
    (data->mlx_ptr, data->win_ptr, data->img_interface, 0, 318);
  return (0);
}

int		init_wolf3d(t_data *data)
{
  if ((data->mlx_ptr = mlx_init()) == 0)
    return (puterr("mlx_init error"));
  if ((data->win_ptr = mlx_new_window
       (data->mlx_ptr, SCREEN_X, SCREEN_Y, "Wold 3D !")) == 0)
    return (puterr("mlx_new_window error"));
  if ((data->img_interface = mlx_xpm_file_to_image
       (data->mlx_ptr, "dukenukem.xpm", &data->x_xpm, &data->y_xpm)) == 0)
    return (puterr("mlx xpm loading fail"));
  return (0);
}

int		main()
{
  t_data	data;

  if ((init_wolf3d(&data)) == -1)
    return (-1);
  if ((wolf3d_img(&data)) == -1)
    return (-1);
  mlx_hook(data.win_ptr, KeyPress, KeyRelease, gere_key, &data);
  mlx_expose_hook(data.win_ptr, gere_expose, &data);
  mlx_loop(data.mlx_ptr);
  return (0);
}
